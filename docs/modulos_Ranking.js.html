<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>JSDoc: Source: modulos/Ranking.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modulos/Ranking.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Jugadores } from './Jugadores.js';
import { Enemigos, JefeFinal } from './enemigos.js';

/**
 * Sistema de batalla por turnos entre jugador y enemigo
 * @param {Jugadores} player - Instancia del jugador
 * @param {Enemigos|JefeFinal} enemy - Instancia del enemigo o jefe final
 * @returns {Object} Objeto con ganador, puntosGanados y detalle de la batalla
 */
export function batalla(player, enemy) {
	// Validaciones
	if (!player || !enemy) {
		return { ganador: 'error', puntosGanados: 0, detalle: 'Faltan argumentos player o enemy' };
	}

	if (!(player instanceof Jugadores) || !(enemy instanceof Enemigos)) {
		return { ganador: 'error', puntosGanados: 0, detalle: 'Los argumentos deben ser instancias de Jugadores y Enemigos' };
	}

	// Obtener estad√≠sticas iniciales del jugador
	const ataqueJugador = player.ataqueTotal();
	const defensaJugador = player.defensaTotal();
	const vidaMaximaJugador = player.vidaTotal(); // Vida m√°xima con bonus de consumibles
	let vidaJugador = vidaMaximaJugador; // El jugador empieza cada batalla con vida completa

	// Obtener estad√≠sticas del enemigo
	const ataqueEnemigo = enemy.nivelataque || 0;
	let vidaEnemigo = enemy.puntosvida || 0;

	// Variables para el registro de batalla
	let turnos = 0;
	const MAX_TURNOS = 100; // Seguridad para evitar bucles infinitos
	let detalle = `‚öîÔ∏è Batalla: ${player.nombre} vs ${enemy.nombre}\n`;
	detalle += `Jugador - ATQ: ${ataqueJugador}, DEF: ${defensaJugador}, VIDA: ${vidaJugador}/${vidaMaximaJugador}\n`;
	detalle += `Enemigo - ATQ: ${ataqueEnemigo}, VIDA: ${vidaEnemigo}\n\n`;

	// SISTEMA DE COMBATE POR TURNOS
	while (vidaJugador > 0 &amp;&amp; vidaEnemigo > 0 &amp;&amp; turnos &lt; MAX_TURNOS) {
		turnos++;
		detalle += `--- Turno ${turnos} ---\n`;

		// TURNO DEL JUGADOR: Atacar al enemigo
		// Vida del enemigo = vida actual - ataque del jugador
		vidaEnemigo = vidaEnemigo - ataqueJugador;
		detalle += `${player.nombre} ataca: ${ataqueJugador} de da√±o ‚Üí Enemigo queda con ${Math.max(0, vidaEnemigo)} HP\n`;

		// Verificar si el enemigo muri√≥
		if (vidaEnemigo &lt;= 0) {
			detalle += `üíÄ ${enemy.nombre} ha sido derrotado!\n`;
			break;
		}

		// TURNO DEL ENEMIGO: Atacar al jugador
		// Vida del jugador = (vida actual + defensa) - ataque del enemigo
		const vidaAnterior = vidaJugador;
		vidaJugador = (vidaJugador + defensaJugador) - ataqueEnemigo;
		detalle += `${enemy.nombre} ataca: ${ataqueEnemigo} de da√±o bloqueado por ${defensaJugador} de defensa ‚Üí Jugador ${vidaAnterior} HP ‚Üí ${Math.max(0, vidaJugador)} HP\n`;

		// Verificar si el jugador muri√≥
		if (vidaJugador &lt;= 0) {
			detalle += `üíÄ ${player.nombre} ha sido derrotado!\n`;
			break;
		}
	}

	// DETERMINAR GANADOR Y CALCULAR PUNTOS
	let ganador;
	let puntosGanados = 0;

	if (vidaJugador > 0 &amp;&amp; vidaEnemigo &lt;= 0) {
		// EL JUGADOR GANA
		ganador = 'player';
		
		// C√ÅLCULO DE PUNTOS SEG√öN ESPECIFICACI√ìN:
		// - 100 puntos base
		// - + da√±o del enemigo
		// - √ó multiplicador si es jefe
		puntosGanados = 100 + ataqueEnemigo;
		
		// Si es un jefe final, multiplicar por su multiplicador
		if (enemy instanceof JefeFinal) {
			puntosGanados = Math.floor(puntosGanados * enemy.multiplicardanio);
			detalle += `üêâ ¬°JEFE DERROTADO! Puntos √ó ${enemy.multiplicardanio} (multiplicador de jefe)\n`;
		}

		detalle += `\n‚úÖ VICTORIA - ${player.nombre} gana ${puntosGanados} puntos!\n`;
		detalle += `C√°lculo: 100 (base) + ${ataqueEnemigo} (da√±o enemigo)${enemy instanceof JefeFinal ? ` √ó ${enemy.multiplicardanio}` : ''} = ${puntosGanados} pts\n`;

		// Sumar puntos al jugador
		player.sumarPuntos(puntosGanados);
		
		// Actualizar vida del jugador (queda con la vida restante)
		player.vida = Math.max(0, vidaJugador);

	} else if (vidaEnemigo > 0 &amp;&amp; vidaJugador &lt;= 0) {
		// EL ENEMIGO GANA
		ganador = 'enemy';
		puntosGanados = 0;
		detalle += `\n‚ùå DERROTA - ${player.nombre} no gana puntos\n`;
		
		// El jugador pierde pero mantiene vida en 0
		player.vida = 0;

	} else {
		// EMPATE (muy raro, pero por seguridad)
		ganador = 'draw';
		puntosGanados = 0;
		detalle += `\n‚öñÔ∏è EMPATE - Batalla finalizada sin vencedor\n`;
	}

	detalle += `Turnos totales: ${turnos}\n`;

	return { ganador, puntosGanados, detalle, turnos };
}

/**
 * Categoriza jugadores seg√∫n su puntuaci√≥n
 * @param {Array&lt;Jugadores>} players - Array de jugadores
 * @param {number} umbral - Umbral para ser "PRO" (por defecto 100)
 * @returns {Array&lt;Object>} Array con jugadores categorizados
 */
export function categorizePlayers(players = [], umbral = 100) {
	const resultado = [];

	for (let i = 0; i &lt; players.length; i++) {
		const p = players[i];
		const puntos = p.puntos || 0;
		
		// Determinar categor√≠a seg√∫n umbral
		const categoria = puntos >= umbral ? 'pro' : 'perdedor';

		resultado.push({ 
			nombre: p.nombre || `Jugador${i + 1}`, 
			puntos, 
			categoria 
		});
	}

	return resultado;
}

/**
 * Muestra un ranking de jugadores ordenado por puntos
 * @param {Array&lt;Jugadores>} players - Array de jugadores
 * @returns {Array&lt;Object>} Tabla de ranking
 */
export function mostrarRanking(players = []) {
	if (!Array.isArray(players)) {
		console.error('mostrarRanking: se esperaba un array de jugadores');
		return;
	}

	const copia = [...players].sort((a, b) => (b.puntos || 0) - (a.puntos || 0));

	const tabla = copia.map((p, idx) => ({
		Pos: idx + 1,
		Nombre: p.nombre || `Jugador${idx + 1}`,
		Puntos: p.puntos || 0,
		Victorias: p.victorias || 0,
		Ataque: typeof p.ataqueTotal === 'function' ? p.ataqueTotal() : (p.nivelataque || 0),
		Defensa: typeof p.defensaTotal === 'function' ? p.defensaTotal() : (p.defensa || 0),
	}));

	console.table(tabla);
	return tabla;
}

/**
 * Imprime un reporte completo de combates, clasificaci√≥n y ranking final
 * @param {Array} rounds - Array de rondas con combates
 * @param {Array&lt;Jugadores>} players - Array de jugadores
 * @returns {Object} Objeto con rondas y ranking
 */
export function mostrarReporteCompleto(rounds = [], players = []) {
	// 1) Mostrar combates por ronda
	for (let r = 0; r &lt; rounds.length; r++) {
		const ronda = rounds[r];
		console.log(`\n‚öîÔ∏è RONDA ${r + 1}`);
		if (!ronda || !Array.isArray(ronda.combates)) {
			console.log('  (sin combates registrados)');
			continue;
		}

		for (const c of ronda.combates) {
			const p = c.playerName || 'Jugador';
			const e = c.enemyName || 'Enemigo';
			const g = c.ganador || 'desconocido';
			const pts = typeof c.puntosGanados === 'number' ? ` | +${c.puntosGanados} pts` : '';
			console.log(`  - ${p} vs ${e} -> ganador: ${g}${pts}`);
		}
	}

	// 2) Clasificaci√≥n por nivel
	const categorias = categorizePlayers(players);
	const pros = categorias.filter(x => x.categoria === 'pro').map(x => x.nombre);
	const perdedores = categorias.filter(x => x.categoria === 'perdedor').map(x => x.nombre);

	console.log('\nüèÜ Clasificaci√≥n por nivel:');
	console.log(` - PRO: ${pros.join(', ') || '---'}`);
	console.log(` - PERDEDOR: ${perdedores.join(', ') || '---'}`);

	// 3) Ranking final detallado
	console.log('\nüèÜ RANKING FINAL üèÜ');

	// Ordenar jugadores por puntos
	const ordenados = [...players].sort((a, b) => (b.puntos || 0) - (a.puntos || 0));

	for (const jugador of ordenados) {
		const nombre = jugador.nombre || 'Jugador';
		const vida = jugador.vida !== undefined ? `${jugador.vida}/${jugador.vidaMaxima || 100}` : 'N/A';
		const puntos = jugador.puntos || 0;
		const ataque = typeof jugador.ataqueTotal === 'function' ? jugador.ataqueTotal() : (jugador.nivelataque || 0);
		const defensa = typeof jugador.defensaTotal === 'function' ? jugador.defensaTotal() : (jugador.defensa || 0);
		const inventario = Array.isArray(jugador.inventario) ? jugador.inventario.map(it => it.nombre || it.tipo || JSON.stringify(it)).join(', ') : 'Sin inventario';

		console.log('\n------------------------------------');
		console.log(` ${nombre}`);
		console.log(` Vida: ${vida}`);
		console.log(` Puntos: ${puntos}`);
		console.log(` Ataque total: ${ataque}`);
		console.log(` Defensa total: ${defensa}`);
		console.log(` Inventario: ${inventario}`);
	}

	return { rondas: rounds.length, ranking: ordenados };
}

export default { batalla, categorizePlayers, mostrarRanking };
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-constants.html">constants</a></li></ul><h3>Classes</h3><ul><li><a href="Enemigos.html">Enemigos</a></li><li><a href="JefeFinal.html">JefeFinal</a></li><li><a href="Jugadores.html">Jugadores</a></li><li><a href="Mercado.html">Mercado</a></li><li><a href="Producto.html">Producto</a></li></ul><h3>Global</h3><ul><li><a href="global.html#EUR">EUR</a></li><li><a href="global.html#actualizarTexto">actualizarTexto</a></li><li><a href="global.html#batalla">batalla</a></li><li><a href="global.html#batallasGanadas">batallasGanadas</a></li><li><a href="global.html#battleBoss">battleBoss</a></li><li><a href="global.html#calcularDescuentoAleatorio">calcularDescuentoAleatorio</a></li><li><a href="global.html#capitalizarPrimeraLetra">capitalizarPrimeraLetra</a></li><li><a href="global.html#categorizePlayers">categorizePlayers</a></li><li><a href="global.html#crearElementoHTML">crearElementoHTML</a></li><li><a href="global.html#createEnemyCard">createEnemyCard</a></li><li><a href="global.html#createProductCard">createProductCard</a></li><li><a href="global.html#enemigoActual">enemigoActual</a></li><li><a href="global.html#enemigos">enemigos</a></li><li><a href="global.html#formatearPrecio">formatearPrecio</a></li><li><a href="global.html#generarPuntosAleatorios">generarPuntosAleatorios</a></li><li><a href="global.html#initializeBattles">initializeBattles</a></li><li><a href="global.html#initializeEnemies">initializeEnemies</a></li><li><a href="global.html#initializeGame">initializeGame</a></li><li><a href="global.html#initializeMarket">initializeMarket</a></li><li><a href="global.html#jefeFinal">jefeFinal</a></li><li><a href="global.html#jugador">jugador</a></li><li><a href="global.html#mercado">mercado</a></li><li><a href="global.html#mezclarArray">mezclarArray</a></li><li><a href="global.html#mostrarRanking">mostrarRanking</a></li><li><a href="global.html#mostrarReporteCompleto">mostrarReporteCompleto</a></li><li><a href="global.html#numeroAleatorio">numeroAleatorio</a></li><li><a href="global.html#objetosComprados">objetosComprados</a></li><li><a href="global.html#obtenerImagenEnemigo">obtenerImagenEnemigo</a></li><li><a href="global.html#obtenerImagenPorTipo">obtenerImagenPorTipo</a></li><li><a href="global.html#productosSeleccionados">productosSeleccionados</a></li><li><a href="global.html#seleccionarAleatorios">seleccionarAleatorios</a></li><li><a href="global.html#setupBattle">setupBattle</a></li><li><a href="global.html#setupBattleBoss">setupBattleBoss</a></li><li><a href="global.html#showBattleResult">showBattleResult</a></li><li><a href="global.html#showFinalResults">showFinalResults</a></li><li><a href="global.html#showScene">showScene</a></li><li><a href="global.html#toggleProductSelection">toggleProductSelection</a></li><li><a href="global.html#toggleVisibilidad">toggleVisibilidad</a></li><li><a href="global.html#updateCart">updateCart</a></li><li><a href="global.html#updateInventoryDisplay">updateInventoryDisplay</a></li><li><a href="global.html#updatePlayerStats">updatePlayerStats</a></li><li><a href="global.html#updateScene3">updateScene3</a></li><li><a href="global.html#validarEnemigo">validarEnemigo</a></li><li><a href="global.html#validarJugador">validarJugador</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Mon Nov 24 2025 12:09:52 GMT+0100 (hora est√°ndar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
